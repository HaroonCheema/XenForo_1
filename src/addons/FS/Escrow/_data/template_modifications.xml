<?xml version="1.0" encoding="utf-8"?>
<template_modifications>
  <modification type="public" template="account_visitor_menu" modification_key="add_deposit_amount" description="add_deposit_amount" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:stats_pairs:above_points]-->]]></find>
    <replace><![CDATA[$0
<xf:if is="true">
						<dl class="pairs pairs--justified fauxBlockLink">
							<dt>{{ phrase('fs_escrow_amount') }}</dt>
							<dd>
								<a href="{{ link('escrow/logs') }}" data-xf-click="overlay" class="fauxBlockLink-linkRow u-concealed">
									{$xf.visitor.deposit_amount|number}
								</a>
							</dd>
						</dl>
					</xf:if>]]></replace>
  </modification>
  <modification type="public" template="account_visitor_menu" modification_key="add_deposit_button" description="add_deposit_button" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<li><a href="{{ link('account/ignored') }}" class="menu-linkRow">{{ phrase('ignoring') }}</a></li>]]></find>
    <replace><![CDATA[$0
<li><a href="{{ link('escrow/deposit') }}" class="menu-linkRow">{{ phrase('fs_escrow_amount_deposit') }}</a></li>]]></replace>
  </modification>
  <modification type="public" template="account_wrapper" modification_key="add_deposit_button_profile_section" description="add_deposit_button_profile_section" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<a class="blockLink {{ \$pageSelected == 'privacy' \? 'is-selected' : '' }}" href="{{ link\('account\/privacy'\) }}">.*?<\/a>/is]]></find>
    <replace><![CDATA[$0
<a class="blockLink {{ \$pageSelected == 'escrow/deposit' ? 'is-selected' : '' }}" href="{{ link('escrow/deposit') }}">
					{{ phrase('fs_escrow_amount_deposit') }}
</a>
]]></replace>
  </modification>
  <modification type="public" template="forum_post_thread" modification_key="fs_escrow_chage_thread_pl_holder" description="fs_escrow_chage_thread_pl_holder" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:prefixinputrow.*?finalhtml="{\$titleFinalHtml}" \/>/is]]></find>
    <replace><![CDATA[<xf:if is="$forum.node_id == $xf.options.fs_escrow_applicable_forum">
	<xf:prefixinputrow
				label="{{ phrase('title') }}"
				prefixes="{$prefixes}"
				type="thread"
				prefix-value="{{ $forum.draft_thread.prefix_id ?: ($thread.prefix_id ?: $forum.default_prefix_id) }}"
				textbox-value="{{ $title ?: $thread.title ?: $forum.draft_thread.title }}"
				textbox-class="input--title"
				placeholder="{{ phrase('fs_escrow_place_holder') }}"
				rowtype="fullWidth noLabel"
				autofocus="autofocus"
				maxlength="{{ max_length('XF:Thread', 'title') }}"
				help-href="{{ link('forums/prefix-help', $forum) }}"
				finalhtml="{$titleFinalHtml}" />
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="forum_post_thread" modification_key="fs_escrow_change_thread_title" description="fs_escrow_change_thread_title" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<xf:title>{{ phrase('post_thread') }}</xf:title>]]></find>
    <replace><![CDATA[<xf:if is="$forum.node_id == $xf.options.fs_escrow_applicable_forum">
<xf:title>{{ phrase('fs_escrow_title') }}</xf:title>
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="forum_post_thread" modification_key="fs_escrow_hide_thread_extra" description="fs_escrow_hide_thread_extra" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:if is="!\$xf\.visitor\.user_id AND !\$forum\.canCreateThreadPreReg\(\)">.*?<\/xf:if>/is]]></find>
    <replace><![CDATA[<xf:if is="$forum.node_id == $xf.options.fs_escrow_applicable_forum">
	
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="forum_post_thread" modification_key="fs_escrow_post_thread_add_fields" description="fs_escrow_post_thread_add_fields" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:macro name="type_fields".*?arg-subContext="full" \/>/is]]></find>
    <replace><![CDATA[<xf:if is="$forum.node_id == $xf.options.fs_escrow_applicable_forum">
	<xf:textboxrow name="to_user" value="{{ $starterFilter ? $starterFilter.username : '' }}" label="{{ phrase('escrow_user') }}" ac="single"
				maxlength="{{ max_length($xf.visitor, 'username') }}" id="ctrl_started_by" />
				<xf:numberboxrow name="escrow_amount" value="" explain="{{ phrase('escrow_total_amount') }} {{$xf.visitor.deposit_amount}}" min="0" label="{{ phrase('escrow_amount') }}" />
			 </xf:if>
			 
			 $0]]></replace>
  </modification>
  <modification type="public" template="member_macros" modification_key="add_amount_to_pofile" description="add_amount_to_pofile" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:stat_pairs:below_trophies]-->]]></find>
    <replace><![CDATA[$0
<xf:if is="$user.user_id == $xf.visitor.user_id OR $xf.visitor.is_admin">
	<dl class="pairs pairs--rows pairs--rows--centered menu-fauxLinkRow">
		<dt>{{ phrase('fs_escrow_amount') }}</dt>
		<dd>
			{{$user.deposit_amount|number }}
		</dd>
	</dl>
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="member_view" modification_key="add_deposit_button_profile_index" description="add_deposit_button_profile_index" execution_order="10" enabled="1" action="preg_replace">
    <find><![CDATA[/<xf:if is="\$user\.user_id == \$xf\.visitor\.user_id && \$xf\.visitor\.canUploadProfileBanner\(\)">
												<xf:button href="{{ link\('account\/banner'\) }}".*?<\/xf:button>
											<\/xf:if>/is]]></find>
    <replace><![CDATA[<xf:if is="$user.user_id == $xf.visitor.user_id ">
	<xf:button href="{{ link('escrow/deposit') }}"
			   class="button--link" >
		{{ phrase('fs_escrow_amount_deposit') }}
	</xf:button>
</xf:if>
$0]]></replace>
  </modification>
  <modification type="public" template="member_view" modification_key="adding_escrow_member_view_tab" description="adding_escrow_member_view_tab" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:tabs:end]-->]]></find>
    <replace><![CDATA[$0
<xf:if is="$user.user_id == $xf.visitor.user_id OR $xf.visitor.is_admin">
	<a href="{{ link('escrow', $user) }}"
	   class="tabs-tab" id="my-escrow" role="tab">
		{{ phrase('fs_my_escrow') }}
	</a>
</xf:if>

<xf:if is="$user.user_id == $xf.visitor.user_id OR $xf.visitor.is_admin">
	<a href="{{ link('escrow', $user) }}"
	   class="tabs-tab" id="mentioned-escrow" role="tab">
		{{ phrase('fs_mentioned_escrow') }}
	</a>
</xf:if>
<xf:if is="$user.user_id == $xf.visitor.user_id OR $xf.visitor.is_admin">
	<a href="{{ link('escrow', $user) }}"
	   class="tabs-tab" id="escrow-logs" role="tab">
		{{ phrase('fs_escrow_logs') }}
	</a>
</xf:if>]]></replace>
  </modification>
  <modification type="public" template="member_view" modification_key="adding_escrow_member_view_tab_content" description="adding_escrow_member_view_tab_content" execution_order="10" enabled="1" action="str_replace">
    <find><![CDATA[<!--[XF:tab_panes:end]-->]]></find>
    <replace><![CDATA[$0
<xf:if is="$user.user_id == $xf.visitor.user_id OR $xf.visitor.is_admin">
<li data-href="{{ link('escrow/my-escrow', $user) }}" role="tabpanel" aria-labelledby="my-escrow">
		<div class="blockMessage">{{ phrase('loading...') }}</div>
</li>
<li data-href="{{ link('escrow/mentioned-escrow', $user) }}" role="tabpanel" aria-labelledby="mentioned-escrow">
		<div class="blockMessage">{{ phrase('loading...') }}</div>
</li>
<li data-href="{{ link('escrow/logs', $user) }}" role="tabpanel" aria-labelledby="escrow-logs">
		<div class="blockMessage">{{ phrase('loading...') }}</div>
</li>
	</xf:if>]]></replace>
  </modification>
</template_modifications>
